---
# defaults file for nextcloud-service

# K3s/Kubernetes Configuration
nextcloud_namespace: nextcloud-prod
nextcloud_replicas: 1
env: prod

# NextCloud Docker Image
nextcloud_docker_image: registry.sysmango.net/nextcloud
nextcloud_docker_image_tag: 31-apache

# Database Configuration
nextcloud_db_connection: 'postgresql.sysmango-data-prod:5432'
create_nextcloud_db: true

# NextCloud Vault Configuration
nextcloud_vault_secret: sysmango/nextcloud-prod
nextcloud_password_from_vault: true

# NextCloud Hostname for Ingress
nextcloud_hostname: nextcloud.sysmango.net

# TLS Configuration
enable_tls: true
cert_resolver: vault-issuer
# cert-manager integration (preferred when using Vault Issuer)
enable_cert_manager: true
certificate_secret_name: nextcloud-tls
certificate_issuer_name: vault-issuer
certificate_issuer_kind: ClusterIssuer

# NFS Configuration (Nextcloud-specific isolated namespace)
# Backward-compat: if legacy nfs_* overrides exist in inventory, honor them.
nc_nfs_server_host: "{{ nfs_server_host | default('files.sysmango.net') }}"
nc_nfs_dir_mode: "{{ nfs_dir_mode | default('0755') }}"
nc_nfs_data_dir_mode: "{{ nfs_data_dir_mode | default('0775') }}"
nc_nfs_dir_owner: "33"
nc_nfs_dir_group: "33"
create_nfs_directories: false

# NFS Paths (Nextcloud-specific isolated namespace)
# Backward-compat with legacy nfs_nextcloud_* overrides
nc_nfs_html_path: "{{ nfs_nextcloud_html_path | default('/srv/nfs/prod/nextcloud/html') }}"
nc_nfs_config_path: "{{ nfs_nextcloud_config_path | default('/srv/nfs/prod/nextcloud/config') }}"
nc_nfs_data_path: "{{ nfs_nextcloud_data_path | default('/srv/nfs/prod/nextcloud/data') }}"
nc_nfs_custom_apps_path: "{{ nfs_nextcloud_custom_apps_path | default('/srv/nfs/prod/nextcloud/custom_apps') }}"

# PVC Sizes
nextcloud_html_pvc_size: 10Gi
nextcloud_config_pvc_size: 1Gi
nextcloud_data_pvc_size: 100Gi
nextcloud_custom_apps_pvc_size: 5Gi

# Resource Limits
nextcloud_resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# Vault Configuration
vault_addr: https://vault.sysmango.net:8200
vault_namespace: ''
pg_vault_secret: sysmango/postgresql-prod
pg_vault_field: postgres_password
pg_password_from_vault: true

# PostgreSQL Connection
postgres_host: postgresql.sysmango-data-prod  # Internal cluster hostname
postgres_external_host: postgres.sysmango.net  # External hostname for Ansible tasks
postgres_user: postgres

# CA Certificate Configuration
ca_configmap_name: sysmango-ca-certificates
ca_configmap_namespace: nextcloud-prod
enable_ca_certificates: true
